<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Виртуальный тур по Пинску</title>
    <link rel="stylesheet" href="pannellum.css">
    <script type="text/javascript" src="pannellum.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        #panorama { width: 100%; height: 100%; background-color: #000; }

        #audio-btn {
            position: absolute; bottom: 20px; right: 20px; z-index: 100;
            background: rgba(0,0,0,0.6); color: white; border: 1px solid white;
            padding: 12px 20px; cursor: pointer; border-radius: 25px;
            font-family: sans-serif; font-size: 16px;
        }

        .custom-hotspot {
            height: 60px !important;
            width: 60px !important;
            background-color: transparent !important;
            border: none !important;
            background-size: contain !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            cursor: pointer;
        }

        .arrow-forward {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 4l-8 8h5v8h6v-8h5z" stroke="black" stroke-width="0.5"/></svg>') !important;
        }

        .arrow-backward {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" stroke="black" stroke-width="0.5"/></svg>') !important;
        }

        .custom-hotspot span {
            display: none !important;
        }
    </style>
</head>
<body>

<div id="panorama"></div>
<button id="audio-btn" onclick="toggleMute()">Выключить звук</button>

<script>
    const audioPlayer = new Audio();
    let isMuted = false;

    const sceneAudios = {
        "pan2_1": "audio_1.mp3",
        "kologe_2": "audio_2.mp3",
        "lenina_c_prava_kol_3": "audio_3_1.mp3",
        "lenina_na_kologe_3_1": "audio_3_1.mp3",
        "moct_3_2": "audio_3_2.mp3",
        "lenina_c_leva_3_3": "audio_3_3.mp3",
        "bk_92_4": "audio_4.mp3"
    };

    const viewer = pannellum.viewer('panorama', {
        "default": {
            "firstScene": "pan2_1",
            "sceneFadeDuration": 1000,
            "autoLoad": true
        },

        "scenes": {
            "pan2_1": {
                "title": "Заезд в Пинск",
                "panorama": "pan2_1.jpg",
                "hotSpots": [
                    { "pitch": 0, "yaw": 0, "type": "scene", "text": "Вперед к Коллегиуму", "sceneId": "kologe_2", "cssClass": "custom-hotspot arrow-forward" }
                ]
            },

            "kologe_2": {
                "title": "Площадь Ленина и коллегиум",
                "panorama": "kolege_2.jpg",
                "hotSpots": [
                    { "pitch": 0, "yaw": 180, "type": "scene", "text": "Назад к началу", "sceneId": "pan2_1", "cssClass": "custom-hotspot arrow-backward" },
                    { "pitch": -23, "yaw": 0, "type": "scene", "text": "Вперед на Ленина", "sceneId": "lenina_c_prava_kol_3", "cssClass": "custom-hotspot arrow-forward" }
                ]
            },

            "lenina_c_prava_kol_3": {
                "title": "Улица Ленина",
                "panorama": "lenina_c_prava_kol_3.jpg",
                "hotSpots": [
                    { "pitch": 0, "yaw": 180, "type": "scene", "text": "Назад к Коллегиуму", "sceneId": "kologe_2", "cssClass": "custom-hotspot arrow-backward" },
                    { "pitch": 5, "yaw": -15, "type": "scene", "text": "Ленина (центр)", "sceneId": "lenina_na_kologe_3_1", "cssClass": "custom-hotspot arrow-forward" },
                    { "pitch": 0, "yaw": 70, "type": "scene", "text": "К мосту", "sceneId": "moct_3_2", "cssClass": "custom-hotspot arrow-forward" },
                    { "pitch": 5, "yaw": -80, "type": "scene", "text": "Ленина (лево)", "sceneId": "lenina_c_leva_3_3", "cssClass": "custom-hotspot arrow-forward" }
                ]
            },

            "lenina_na_kologe_3_1": {
                "title": "Ленина",
                "panorama": "lenina_na_kologe_3_1.jpg",
                "hotSpots": [
                    { "pitch": 0, "yaw": 180, "type": "scene", "text": "Назад к развилке", "sceneId": "lenina_c_prava_kol_3", "cssClass": "custom-hotspot arrow-backward" },
                    { "pitch": 0, "yaw": 0, "type": "scene", "text": "Вперед к БК-92", "sceneId": "bk_92_4", "cssClass": "custom-hotspot arrow-forward" }
                ]
            },

            "moct_3_2": {
                "title": "Мост через Пину",
                "panorama": "moct_3_2.jpg",
                "hotSpots": [
                    { "pitch": 0, "yaw": 180, "type": "scene", "text": "Назад к развилке", "sceneId": "lenina_c_prava_kol_3", "cssClass": "custom-hotspot arrow-backward" },
                    { "pitch": 0, "yaw": 0, "type": "scene", "text": "Вперед к БК-92", "sceneId": "bk_92_4", "cssClass": "custom-hotspot arrow-forward" }
                ]
            },

            "lenina_c_leva_3_3": {
                "title": "Ленина",
                "panorama": "lenina_c_leva_3_3.jpg",
                "hotSpots": [
                    { "pitch": 0, "yaw": 180, "type": "scene", "text": "Назад к развилке", "sceneId": "lenina_c_prava_kol_3", "cssClass": "custom-hotspot arrow-backward" },
                    { "pitch": 0, "yaw": 0, "type": "scene", "text": "Вперед к БК-92", "sceneId": "bk_92_4", "cssClass": "custom-hotspot arrow-forward" }
                ]
            },

            "bk_92_4": {
                "title": "Парк (БК-92)",
                "panorama": "bk_92_4.jpg",
                "hotSpots": [
                    { "pitch": 0, "yaw": -40, "type": "scene", "text": "Назад к Ленина", "sceneId": "lenina_na_kologe_3_1", "cssClass": "custom-hotspot arrow-backward" },
                    { "pitch": 0, "yaw": 0, "type": "scene", "text": "Назад к мосту", "sceneId": "moct_3_2", "cssClass": "custom-hotspot arrow-backward" },
                    { "pitch": 0, "yaw": 40, "type": "scene", "text": "Назад к Ленина", "sceneId": "lenina_c_leva_3_3", "cssClass": "custom-hotspot arrow-backward" }
                ]
            }
        }
    });

    function playAudio(sceneId) {
        if (isMuted) return;
        const src = sceneAudios[sceneId];
        if (src) {
            audioPlayer.src = src;
            audioPlayer.load();
            audioPlayer.play().catch(e => console.log("Браузер ожидает взаимодействия"));
        }
    }

    viewer.on('scenechange', (id) => playAudio(id));

    function toggleMute() {
        isMuted = !isMuted;
        const btn = document.getElementById('audio-btn');
        if (isMuted) {
            audioPlayer.pause();
            btn.innerText = "Включить звук";
        } else {
            btn.innerText = "Выключить звук";
            playAudio(viewer.getScene());
        }
    }

    document.body.addEventListener('click', () => {
        if (audioPlayer.src === "") playAudio(viewer.getScene());
    }, { once: true });

</script>
</body>
</html>